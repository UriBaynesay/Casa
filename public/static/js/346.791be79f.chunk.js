"use strict";(self.webpackChunkcasa=self.webpackChunkcasa||[]).push([[346],{6390:function(e,t,r){r.d(t,{X:function(){return i}});var n=r(4165),a=r(5861),s=r(7265),c="order",i={query:function(e){return d.apply(this,arguments)},saveOrder:function(e){return o.apply(this,arguments)},getById:function(e){return u.apply(this,arguments)},remove:function(e){return l.apply(this,arguments)},getUserOrdersStats:function(e){var t={};return e?(t.avgRating=h(e),t.totalRevenue=p(e),t.ordersStatus=v(e),t):{avgRating:0,totalRevenue:0,ordersStatus:{total:0,pending:0,accepted:0,declined:0}}}};function d(){return(d=(0,a.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.R.get(c,t);case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0.data;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function u(){return(u=(0,a.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.R.get("".concat(c,"/").concat(t));case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0.data;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function l(){return(l=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.R.delete("".concat(c,"/").concat(t));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0.data;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function o(){return(o=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._id){e.next=11;break}return e.prev=1,e.next=4,s.R.post(c,t);case 4:return r=e.sent,e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(1),e.t0.data;case 11:return e.prev=11,e.next=14,s.R.put("".concat(c,"/").concat(t._id),t);case 14:return a=e.sent,e.abrupt("return",a);case 18:throw e.prev=18,e.t1=e.catch(11),e.t1.data;case 21:case"end":return e.stop()}}),e,null,[[1,8],[11,18]])})))).apply(this,arguments)}function h(e){return e.reduce((function(e,t){return e+t.stay.reviewScores.rating}),0)/e.length}function p(e){return e.reduce((function(e,t){return"accepted"===t.status?e+t.price:e}),0)}function v(e){return e.reduce((function(e,t){return e.total++,"pending"===t.status?e.pending++:"accepted"===t.status?e.accepted++:"declined"===t.status&&e.declined++,e}),{total:0,pending:0,accepted:0,declined:0})}},8346:function(e,t,r){r.r(t),r.d(t,{default:function(){return j}});var n=r(1413),a=r(4165),s=r(5861),c=r(885),i=r(2791),d=r(9434),u=r(6390),l=r(1280),o=r(184),h=function(e){var t=e.order,r=e.onUpdateOrder;return(0,o.jsxs)("article",{className:"order-preview-container",children:[(0,o.jsx)("div",{className:"stay-name",children:t.stay.name}),(0,o.jsx)("div",{className:"user-fullname",children:t.byUser.fullname}),(0,o.jsxs)("div",{className:"order-total",children:[t.price," $"]}),(0,o.jsx)("div",{className:"order-start-date",children:new Date(t.startDate).toLocaleDateString()}),(0,o.jsx)("div",{className:"order-end-date",children:new Date(t.endDate).toLocaleDateString()}),(0,o.jsx)("div",{className:"order-status",children:t.status}),(0,o.jsxs)("div",{className:"action-container",children:[(0,o.jsx)("button",{className:"accept-btn",disabled:"accepted"===t.status,onClick:function(){return r(t,"accepted")},children:(0,o.jsx)("div",{children:"Accept"})}),(0,o.jsx)("button",{className:"decline-btn",disabled:"declined"===t.status,onClick:function(){return r(t,"declined")},children:(0,o.jsx)("div",{children:"Decline"})})]})]})},p=function(e){var t=e.orders,r=e.onUpdateOrder;return(0,o.jsx)("div",{className:"user-orders-list-container",children:t.map((function(e){return(0,o.jsx)(h,{order:e,onUpdateOrder:r},e._id)}))})},v=function(e){var t=e.orders,r=u.X.getUserOrdersStats(t);return(0,o.jsxs)("div",{className:"stats-container",children:[(0,o.jsxs)("div",{className:"avg-rating-container",children:[(0,o.jsx)("h1",{children:"Avg rating"}),(0,o.jsx)("h3",{children:r.avgRating})]}),(0,o.jsxs)("div",{className:"total-revenue-container",children:[(0,o.jsx)("h1",{children:"Total revenue"}),(0,o.jsxs)("h3",{children:["$ ",r.totalRevenue]})]}),(0,o.jsxs)("div",{className:"orders-status-container",children:[(0,o.jsxs)("div",{className:"total-orders-container",children:[(0,o.jsx)("h1",{children:"Total"}),(0,o.jsx)("h3",{children:r.ordersStatus.total})]}),(0,o.jsxs)("div",{className:"pending-orders-container",children:[(0,o.jsx)("h1",{children:"Pending"}),(0,o.jsx)("h3",{children:r.ordersStatus.pending})]}),(0,o.jsxs)("div",{className:"total-accepted-container",children:[(0,o.jsx)("h1",{children:"Accepted"}),(0,o.jsx)("h3",{children:r.ordersStatus.accepted})]}),(0,o.jsxs)("div",{className:"declined-accepted-container",children:[(0,o.jsx)("h1",{children:"Declined"}),(0,o.jsx)("h3",{children:r.ordersStatus.declined})]})]})]})},f=r(3261),x=r(2506),j=function(){var e=(0,i.useState)([]),t=(0,c.Z)(e,2),r=t[0],h=t[1],j=(0,d.v9)((function(e){return e.userModule})).user,m=(0,d.I0)();(0,i.useEffect)((function(){return l.LR.on(l.bV,g),l.LR.on(l.zb,g),j&&(m((0,f.h0)(!1)),r.length||g()),function(){l.LR.off(l.bV,g),l.LR.off(l.zb,g)}}),[]);var g=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.X.query({hostId:j._id});case 3:(t=e.sent).length&&h(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},t),{},{status:r}),e.prev=1,e.next=4,u.X.saveOrder(s);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,r){return e.apply(this,arguments)}}();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.t,{}),(0,o.jsx)("main",{className:"user-profile main-layout",children:(0,o.jsxs)("section",{className:"user-orders-container",children:[r.length?(0,o.jsx)(v,{orders:r}):"",(0,o.jsx)("h2",{className:"order-title",children:"Orders for your stays"}),r.length?(0,o.jsxs)(i.Fragment,{children:[(0,o.jsx)("div",{className:"user-orders-table-titles-container",children:[{class:"stay-name-title",title:"Stay name"},{class:"user-fullname-title",title:"Guest name"},{class:"order-total-title",title:"Order total"},{class:"order-start-date-title",title:"Start date"},{class:"order-end-date-title",title:"End date"},{class:"order-status-title",title:"Order status"},{class:"action-title",title:"Actions"}].map((function(e){return(0,o.jsx)("h4",{className:e.class,children:e.title},e.title)}))}),(0,o.jsx)(p,{orders:r,onUpdateOrder:N})]}):(0,o.jsx)("p",{children:"No orders"})]})})]})}}}]);
//# sourceMappingURL=346.791be79f.chunk.js.map